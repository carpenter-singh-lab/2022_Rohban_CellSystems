Inspect gene-compound connections
================

``` r
library(magrittr)
library(glue)
library(tidyverse)
```

This file was very likely created using this code
<https://github.com/broadinstitute/2016_08_22_Gene_Compound/blob/f08ccc2b4763376dd00010bed559f3d531b61dd2/archive/CDRP_per_gene_analysis_mutants.Rmd#L335-L339>

i.e. it has the Pearson correlation between genes and compounds

``` r
connections <- readRDS("../archive/rds_files/cr_melt_cp.rds")
```

``` r
set.seed(42)
connections %>% 
  sample_n(10)
```

<div class="kable-table">

| Var1                   | Var2           |      value |
|:-----------------------|:---------------|-----------:|
| BRD-K96900359-001-01-6 | PTEN\_WT       |  0.0201357 |
| BRD-K37794655-001-05-7 | AKT1S1\_WT.2   |  0.4353168 |
| BRD-K26924781-001-01-9 | GSK3B\_WT.1    |  0.2483352 |
| BRD-K76624532-001-01-6 | RAC1\_Q61L     |  0.1688656 |
| BRD-A10216015-001-06-7 | PTEN\_WT       |  0.4089549 |
| BRD-K78623196-001-05-4 | PPARGC1A\_WT.2 | -0.1716521 |
| BRD-K82538319-001-01-9 | CRY1\_WT.1     | -0.0001882 |
| BRD-A31650268-001-05-8 | YAP1\_WT.1     | -0.2440378 |
| BRD-K11687039-001-01-9 | MOS\_WT.1      | -0.1712846 |
| BRD-K55677650-003-01-1 | YAP1\_WT.3     |  0.1124160 |

</div>

``` r
connections %>%
  filter(Var2 == "PPARGC1A_WT.2") %>%
  count(name = "Number of connections with compounds")
```

<div class="kable-table">

| Number of connections with compounds |
|-------------------------------------:|
|                                15864 |

</div>

``` r
connections %>%
  filter(Var2 == "PPARGC1A_WT.2") %>%
  ggplot(aes(value)) + geom_histogram(bins = 100) +
  ggtitle("Distribution of Pearson similarity of compounds to PPARGC1A_WT.2")
```

![](2.inspect-gene-compound_files/figure-gfm/unnamed-chunk-5-1.png)<!-- -->

We need `PUBCHEM_CID` from the `Var1` column

`Var1` is `CPD_NAME`, which was loaded here

<https://github.com/broadinstitute/2016_08_22_Gene_Compound/blob/f08ccc2b4763376dd00010bed559f3d531b61dd2/archive/CDRP_per_gene_analysis_mutants.Rmd#L101>

``` r
cdrp_cpd_metadata <- 
  read_csv("../input/CDP2/cdrp.cpd.meta.csv") %>%
  mutate(CPD_NAME = tolower(CPD_NAME)) 
```

    ## 
    ## ── Column specification ──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
    ## cols(
    ##   idCDP = col_double(),
    ##   BROAD_CPD_ID = col_character(),
    ##   CPD_ID = col_double(),
    ##   CPD_NAME = col_character(),
    ##   CPD_NAME_TYPE = col_character(),
    ##   cpd_type = col_character(),
    ##   CBP_SMILES = col_character()
    ## )

``` r
connections <-
  connections %>%
  left_join(
    connections %>%
      select(Var1) %>%
      inner_join(
        cdrp_cpd_metadata %>%
          select(CPD_NAME, BROAD_CPD_ID),
        by = c("Var1" = "CPD_NAME")
      ) %>%
      distinct()
  ) %>%
  mutate(BROAD_CPD_ID =
           ifelse(is.na(BROAD_CPD_ID),
                  str_sub(Var1, 1, 13),
                  BROAD_CPD_ID))
```

    ## Joining, by = "Var1"

We now have `BROAD_CPD_ID` for all compounds

``` r
set.seed(42)
connections %>% 
  sample_n(10)
```

<div class="kable-table">

| Var1                   | Var2           |      value | BROAD\_CPD\_ID |
|:-----------------------|:---------------|-----------:|:---------------|
| BRD-K74639017-001-01-0 | PTEN\_WT       |  0.0364617 | BRD-K74639017  |
| BRD-K36778976-001-01-2 | AKT1S1\_WT.2   | -0.0046880 | BRD-K36778976  |
| BRD-K13941052-001-01-0 | GSK3B\_WT.1    |  0.2669709 | BRD-K13941052  |
| BRD-K54148510-001-01-8 | RAC1\_Q61L     |  0.2730935 | BRD-K54148510  |
| boc-gvv-cho            | PRKCZ\_WT.2    |  0.1422907 | BRD-K79053258  |
| BRD-K59650319-003-01-7 | PPARGC1A\_WT.2 | -0.0512839 | BRD-K59650319  |
| BRD-K74688087-001-06-1 | CRY1\_WT.1     |  0.0672458 | BRD-K74688087  |
| BRD-K70542395-001-05-3 | XBP1\_WT.2     |  0.2117146 | BRD-K70542395  |
| tetracycline           | MOS\_WT.1      | -0.0344407 | BRD-A34788695  |
| BRD-K22701871-001-05-7 | YAP1\_WT.3     |  0.4014607 | BRD-K22701871  |

</div>

The next challenge is to figure out how to get PubChem CID from the
Broad ID, because that is what will help us map to the PGC1a screen.

Turns out that is not so simple <https://www.biostars.org/p/249949/>

More to come
